<!doctype html>
<html>
<head>
<title>Deadbeat Escapement Simulator</title>
</head>
<body>
<h1>Deadbeat Escapement Simulator</h1>

<canvas id="canvas" width="400" height="600"></canvas>

<script src="planck.min.js"></script>
<script src="renderer.js"></script>
<script src="escapewheel.js"></script>

<script type="text/javascript">
    const { World, Vec2, Box, Circle, Polygon, DistanceJoint, RevoluteJoint } = planck;
    const world = new World({
        gravity: Vec2(0.0, -9.81),
    });

    const renderer = new Renderer(world, 'canvas');

    let fixed = world.createBody({
        type: 'static',
        position: Vec2(0.0, 0.0),
    });

    let bob = world.createBody({
        type: 'dynamic',
        position: Vec2(0.5, -0.5),
    });
    bob.createFixture({
        shape: new Circle(0.25, Vec2(0, 0)),
        density: 1.0,
        friction: 0.3,
    });

    let escapeWheel = world.createBody({
        type: 'dynamic',
        position: Vec2(0.0, 0.5),
    });
    addEscapeWheelFixtures(escapeWheel, {
        teeth: 15,
        minorDiameter: 0.4,
        majorDiameter: 0.6,
        leadingAngle: 5,
        trailingAngle: 8,
        density: 1.0,
        friction: 0.3,
    });

    let pendulumJoint = world.createJoint(new DistanceJoint({}, bob, fixed, bob.getPosition(), Vec2(0, 0.5)));
    let escapeWheelJoint = world.createJoint(new RevoluteJoint({
        maxMotorTorque: 1000, // ??
        motorSpeed: 1, // rads/sec?
        enableMotor: true,
    }, fixed, escapeWheel, escapeWheel.getPosition()));

</script>
</body>
</html>
